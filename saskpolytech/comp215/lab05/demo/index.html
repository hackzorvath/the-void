<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Choose Your Pokémon!</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="container">
        <h2 class="text-center mb-4">Choose Your Pokémon!</h2>
        <form id="trainerForm" class="needs-validation" novalidate>
            <div class="row g-4 align-items-start">
                <!-- Left Column -->
                <div class="col-md-7">
                    <!-- 1. Pokémon Family - Selection is made with a dropdown option -->
                    <div class="mb-3">
                        <label for="pokemonSelect" class="form-label">1. Pokémon:</label>
                        <select id="pokemonSelect" class="form-select" required>
                            <option value="">Choose your Pokémon...</option>
                            <option value="bulbasaur">Bulbasaur</option>
                            <option value="charmander">Charmander</option>
                            <option value="squirtle">Squirtle</option>
                        </select>
                        <div class="invalid-feedback">Please choose your Pokémon!</div>
                    </div>

                    <!-- 2. Evolution Stage - Selection is made with radio buttons-->
                    <div id="stageContainer" class="mb-3">
                        <label class="form-label d-block">2. Evolution Stage:</label>
                        <div class="form-check">
                            <input type="radio" name="stage" id="stage1" value="1" class="form-check-input" required>
                            <label class="form-check-label" for="stage1">Stage 1</label>
                        </div>
                        <div class="form-check">
                            <input type="radio" name="stage" id="stage2" value="2" class="form-check-input" required>
                            <label class="form-check-label" for="stage2">Stage 2</label>
                        </div>
                        <div class="form-check">
                            <input type="radio" name="stage" id="stage3" value="3" class="form-check-input" required>
                            <label class="form-check-label" for="stage3">Stage 3</label>
                        </div>
                        <div class="invalid-feedback">Please choose an evolution stage.</div>
                    </div>

                    <!-- 3. Mega Evolution Checkbox - Selection is made with a boolean checkbox -->
                    <div id="megaContainer" class="form-check mb-3 d-none">
                        <input class="form-check-input" type="checkbox" id="isMega">
                        <label class="form-check-label" for="isMega">Mega Evolution?</label>
                    </div>
                    <!-- 4. Nickname - JavaScript is used to validate the requirements of the nickname -->
                    <div class="mb-3">
                        <label for="nickname" class="form-label">4. Nickname:</label>
                        <input type="text" id="nickname" class="form-control" placeholder="Enter nickname" minlength="3"
                            maxlength="12" pattern="^[A-Za-z0-9]+$" required>
                        <div class="form-text">3–12 characters, letters and numbers only.</div>
                        <div class="invalid-feedback">Nickname must be 3–12 letters or numbers.</div>
                    </div>

                    <!-- 5. Friendship Slider - Selection is made with a range input -->
                    <div class="mb-3">
                        <label for="friendship" class="form-label">
                            Friendship Level: <span id="friendshipValue">128</span>
                        </label>
                        <input type="range" class="form-range" min="0" max="255" id="friendship" value="128">
                    </div>

                    <!-- 6. Submit - Form is submitted with a button -->
                    <div class="text-center">
                        <button type="button" id="confirmBtn" class="btn btn-primary w-75">Confirm Selection</button>
                    </div>
                </div>

                <!-- Image Gallery -->
                <div class="col-md-5 text-center">
                    <img id="pokemonImage" src="" alt="Pokémon Preview">
                    <div id="feedback" class="alert alert-info text-center d-none mt-3" role="alert">
                        Choose wisely, Trainer...
                    </div>
                </div>
            </div>
        </form>
    </div>

    <!-- JavaScript -->
    <script>
        const form = document.getElementById("trainerForm");
        const pokemonSelect = document.getElementById("pokemonSelect");
        const megaContainer = document.getElementById("megaContainer");
        const stageRadios = document.querySelectorAll("input[name='stage']");
        const confirmBtn = document.getElementById("confirmBtn");
        const pokemonImage = document.getElementById("pokemonImage");
        const feedback = document.getElementById("feedback");
        const friendship = document.getElementById("friendship");
        const friendshipValue = document.getElementById("friendshipValue");

        const pokedex = {
            bulbasaur: ["001", "002", "003"],
            charmander: ["004", "005", "006"],
            squirtle: ["007", "008", "009"]
        };

        const evolutions = {
            bulbasaur: ["Bulbasaur", "Ivysaur", "Venusaur"],
            charmander: ["Charmander", "Charmeleon", "Charizard"],
            squirtle: ["Squirtle", "Wartortle", "Blastoise"]
        };

        pokemonSelect.addEventListener("change", updateBorder);
        stageRadios.forEach(r => r.addEventListener("change", toggleMega));
        confirmBtn.addEventListener("click", showResult);
        friendship.addEventListener("input", () => friendshipValue.textContent = friendship.value);
        document.getElementById("isMega").addEventListener("change", updateImage);

        function updateBorder() {
            const selected = pokemonSelect.value;
            form.classList.remove("bulbasaur", "charmander", "squirtle");

            if (!selected) {
                pokemonImage.style.display = "none";
                feedback.classList.add("d-none");
                return;
            }

            // Apply border colour
            form.classList.add(selected);

            // Default to Stage 1 when a Pokémon is chosen
            const stage1 = document.getElementById("stage1");
            stage1.checked = true;
            toggleMega();       // ensure Mega checkbox hides
            updateImage();      // refresh the preview

            // Feedback text
            feedback.classList.remove("d-none");
            feedback.textContent = `You selected ${selected.charAt(0).toUpperCase() + selected.slice(1)}.`;
        }

        function toggleMega() {
            const selectedStage = document.querySelector("input[name='stage']:checked");
            if (!selectedStage) return;
            megaContainer.classList.toggle("d-none", selectedStage.value !== "3");
            updateImage();
        }

        function updateImage() {
            const pokemon = pokemonSelect.value;
            const stage = document.querySelector("input[name='stage']:checked")?.value;
            const isMega = document.getElementById("isMega").checked;

            if (!pokemon || !stage) {
                pokemonImage.style.display = "none";
                pokemonImage.classList.remove("visible");
                return;
            }

            const number = pokedex[pokemon][stage - 1];
            let baseName = evolutions[pokemon][stage - 1].toLowerCase();
            let filename = `${number}-${baseName}`;
            if (isMega && stage === "3") filename += "-M";
            const path = `pokemon/${filename}.png`;

            pokemonImage.src = path;
            pokemonImage.style.display = "block";
            requestAnimationFrame(() => pokemonImage.classList.add("visible"));
        }

        function showResult() {
            if (!form.checkValidity()) {
                form.classList.add("was-validated");
                return;
            }

            updateImage();

            const name = document.getElementById("nickname").value;
            const pokemon = pokemonSelect.value;
            const stage = document.querySelector("input[name='stage']:checked").value;
            const isMega = document.getElementById("isMega").checked;

            let summary = `You’ve chosen ${name || "a mysterious Pokémon"} — `;
            summary += evolutions[pokemon][stage - 1];
            if (isMega && stage === "3") summary += " (Mega Evolution!)";
            summary += ` with friendship level ${friendship.value}.`;

            feedback.textContent = summary;
            feedback.classList.remove("alert-info");
            feedback.classList.add("alert-success");
            feedback.classList.remove("d-none");
        }
    </script>
</body>

</html>